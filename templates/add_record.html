{% extends "base.html" %}

{% block title %}Add Health Record - {{ patient.fullName }} - PHMS{% endblock %}

{% block content %}
<div class="form-page">
    <div class="page-header">
        <div>
            <a href="{{ url_for('patients.patient_detail', patient_id=patient._id) }}" class="breadcrumb">← {{ patient.fullName }}</a>
            <h1>Add Health Record</h1>
        </div>
    </div>
    
    <div class="form-container">
        <form method="POST" action="{{ url_for('records.create_record', patient_id=patient._id) }}" class="health-record-form">
            
            <!-- Timestamp -->
            <div class="form-section">
                <h3 class="section-title">Record Information</h3>
                <div class="form-group">
                    <label for="timestamp">Date & Time <span class="required">*</span></label>
                    <input 
                        type="datetime-local" 
                        id="timestamp" 
                        name="timestamp" 
                        class="form-control"
                        value="{{ now.strftime('%Y-%m-%dT%H:%M') }}"
                        required
                    >
                </div>
            </div>
            
            <!-- Vitals -->
            <div class="form-section">
                <h3 class="section-title">Vitals</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="bpSystolic">Blood Pressure Systolic</label>
                        <input type="number" step="0.01" id="bpSystolic" name="bpSystolic" class="form-control" placeholder="mmHg">
                    </div>
                    
                    <div class="form-group">
                        <label for="bpDiastolic">Blood Pressure Diastolic</label>
                        <input type="number" step="0.01" id="bpDiastolic" name="bpDiastolic" class="form-control" placeholder="mmHg">
                    </div>
                    
                    <div class="form-group">
                        <label for="heartRate">Heart Rate</label>
                        <input type="number" step="0.01" id="heartRate" name="heartRate" class="form-control" placeholder="bpm">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="temperature">Temperature</label>
                        <input type="number" step="0.01" id="temperature" name="temperature" class="form-control" placeholder="°C">
                    </div>
                    
                    <div class="form-group">
                        <label for="spo2">SpO2</label>
                        <input type="number" step="0.01" id="spo2" name="spo2" class="form-control" placeholder="%">
                    </div>
                    
                    <div class="form-group">
                        <label for="weight">Weight</label>
                        <input type="number" step="0.01" id="weight" name="weight" class="form-control" placeholder="kg">
                    </div>
                    
                    <div class="form-group">
                        <label for="height">Height</label>
                        <input type="number" step="0.01" id="height" name="height" class="form-control" placeholder="cm">
                    </div>
                </div>
            </div>
            
            <!-- Diabetes / Glucose -->
            <div class="form-section">
                <h3 class="section-title">Diabetes / Glucose</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="sugarFasting">Fasting Blood Sugar</label>
                        <input type="number" step="0.01" id="sugarFasting" name="sugarFasting" class="form-control" placeholder="mg/dL">
                    </div>
                    
                    <div class="form-group">
                        <label for="sugarPostMeal">Post-Meal Blood Sugar</label>
                        <input type="number" step="0.01" id="sugarPostMeal" name="sugarPostMeal" class="form-control" placeholder="mg/dL">
                    </div>
                    
                    <div class="form-group">
                        <label for="randomBloodSugar">Random Blood Sugar</label>
                        <input type="number" step="0.01" id="randomBloodSugar" name="randomBloodSugar" class="form-control" placeholder="mg/dL">
                    </div>
                    
                    <div class="form-group">
                        <label for="hbA1c">HbA1c</label>
                        <input type="number" step="0.01" id="hbA1c" name="hbA1c" class="form-control" placeholder="%">
                    </div>
                </div>
            </div>
            
            <!-- Lipid Profile -->
            <div class="form-section">
                <h3 class="section-title">Lipid Profile</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="cholesterolTotal">Total Cholesterol</label>
                        <input type="number" step="0.01" id="cholesterolTotal" name="cholesterolTotal" class="form-control" placeholder="mg/dL">
                    </div>
                    
                    <div class="form-group">
                        <label for="cholesterolHDL">HDL Cholesterol</label>
                        <input type="number" step="0.01" id="cholesterolHDL" name="cholesterolHDL" class="form-control" placeholder="mg/dL">
                    </div>
                    
                    <div class="form-group">
                        <label for="cholesterolLDL">LDL Cholesterol</label>
                        <input type="number" step="0.01" id="cholesterolLDL" name="cholesterolLDL" class="form-control" placeholder="mg/dL">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="triglycerides">Triglycerides</label>
                        <input type="number" step="0.01" id="triglycerides" name="triglycerides" class="form-control" placeholder="mg/dL">
                    </div>
                    
                    <div class="form-group">
                        <label for="vldl">VLDL</label>
                        <input type="number" step="0.01" id="vldl" name="vldl" class="form-control" placeholder="mg/dL">
                    </div>
                </div>
            </div>
            
            <!-- Kidney Function -->
            <div class="form-section">
                <h3 class="section-title">Kidney Function</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="serumCreatinine">Serum Creatinine</label>
                        <input type="number" step="0.01" id="serumCreatinine" name="serumCreatinine" class="form-control" placeholder="mg/dL">
                    </div>
                    
                    <div class="form-group">
                        <label for="bloodUrea">Blood Urea</label>
                        <input type="number" step="0.01" id="bloodUrea" name="bloodUrea" class="form-control" placeholder="mg/dL">
                    </div>
                    
                    <div class="form-group">
                        <label for="bun">BUN</label>
                        <input type="number" step="0.01" id="bun" name="bun" class="form-control" placeholder="mg/dL">
                    </div>
                    
                    <div class="form-group">
                        <label for="eGFR">eGFR</label>
                        <input type="number" step="0.01" id="eGFR" name="eGFR" class="form-control" placeholder="mL/min/1.73m²">
                    </div>
                </div>
            </div>
            
            <!-- Liver Function -->
            <div class="form-section">
                <h3 class="section-title">Liver Function</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="sgptAlt">SGPT/ALT</label>
                        <input type="number" step="0.01" id="sgptAlt" name="sgptAlt" class="form-control" placeholder="U/L">
                    </div>
                    
                    <div class="form-group">
                        <label for="sgotAst">SGOT/AST</label>
                        <input type="number" step="0.01" id="sgotAst" name="sgotAst" class="form-control" placeholder="U/L">
                    </div>
                    
                    <div class="form-group">
                        <label for="alkalinePhosphatase">Alkaline Phosphatase</label>
                        <input type="number" step="0.01" id="alkalinePhosphatase" name="alkalinePhosphatase" class="form-control" placeholder="U/L">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="totalBilirubin">Total Bilirubin</label>
                        <input type="number" step="0.01" id="totalBilirubin" name="totalBilirubin" class="form-control" placeholder="mg/dL">
                    </div>
                    
                    <div class="form-group">
                        <label for="directBilirubin">Direct Bilirubin</label>
                        <input type="number" step="0.01" id="directBilirubin" name="directBilirubin" class="form-control" placeholder="mg/dL">
                    </div>
                    
                    <div class="form-group">
                        <label for="indirectBilirubin">Indirect Bilirubin</label>
                        <input type="number" step="0.01" id="indirectBilirubin" name="indirectBilirubin" class="form-control" placeholder="mg/dL">
                    </div>
                </div>
            </div>
            
            <!-- Electrolytes -->
            <div class="form-section">
                <h3 class="section-title">Electrolytes</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="sodium">Sodium</label>
                        <input type="number" step="0.01" id="sodium" name="sodium" class="form-control" placeholder="mEq/L">
                    </div>
                    
                    <div class="form-group">
                        <label for="potassium">Potassium</label>
                        <input type="number" step="0.01" id="potassium" name="potassium" class="form-control" placeholder="mEq/L">
                    </div>
                    
                    <div class="form-group">
                        <label for="chloride">Chloride</label>
                        <input type="number" step="0.01" id="chloride" name="chloride" class="form-control" placeholder="mEq/L">
                    </div>
                </div>
            </div>
            
            <!-- Hematology (CBC) -->
            <div class="form-section">
                <h3 class="section-title">Hematology (CBC)</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="hemoglobin">Hemoglobin</label>
                        <input type="number" step="0.01" id="hemoglobin" name="hemoglobin" class="form-control" placeholder="g/dL">
                    </div>
                    
                    <div class="form-group">
                        <label for="totalLeukocyteCount">WBC Count</label>
                        <input type="number" step="0.01" id="totalLeukocyteCount" name="totalLeukocyteCount" class="form-control" placeholder="cells/μL">
                    </div>
                    
                    <div class="form-group">
                        <label for="plateletCount">Platelet Count</label>
                        <input type="number" step="0.01" id="plateletCount" name="plateletCount" class="form-control" placeholder="lakhs">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="rbcCount">RBC Count</label>
                        <input type="number" step="0.01" id="rbcCount" name="rbcCount" class="form-control" placeholder="million/μL">
                    </div>
                    
                    <div class="form-group">
                        <label for="pcv">PCV</label>
                        <input type="number" step="0.01" id="pcv" name="pcv" class="form-control" placeholder="%">
                    </div>
                    
                    <div class="form-group">
                        <label for="mcv">MCV</label>
                        <input type="number" step="0.01" id="mcv" name="mcv" class="form-control" placeholder="fL">
                    </div>
                </div>
            </div>
            
            <!-- Thyroid -->
            <div class="form-section">
                <h3 class="section-title">Thyroid Function</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="tsh">TSH</label>
                        <input type="number" step="0.01" id="tsh" name="tsh" class="form-control" placeholder="μIU/mL">
                    </div>
                    
                    <div class="form-group">
                        <label for="t3">T3</label>
                        <input type="number" step="0.01" id="t3" name="t3" class="form-control" placeholder="ng/dL">
                    </div>
                    
                    <div class="form-group">
                        <label for="t4">T4</label>
                        <input type="number" step="0.01" id="t4" name="t4" class="form-control" placeholder="μg/dL">
                    </div>
                </div>
            </div>
            
            <!-- Vitamins -->
            <div class="form-section">
                <h3 class="section-title">Vitamins</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="vitaminD">Vitamin D</label>
                        <input type="number" step="0.01" id="vitaminD" name="vitaminD" class="form-control" placeholder="ng/mL">
                    </div>
                    
                    <div class="form-group">
                        <label for="vitaminB12">Vitamin B12</label>
                        <input type="number" step="0.01" id="vitaminB12" name="vitaminB12" class="form-control" placeholder="pg/mL">
                    </div>
                </div>
            </div>
            
            <!-- Notes -->
            <div class="form-section">
                <h3 class="section-title">Additional Notes</h3>
                
                <div class="form-group">
                    <label for="notes">Notes</label>
                    <textarea 
                        id="notes" 
                        name="notes" 
                        class="form-control"
                        rows="4"
                        placeholder="Any additional observations or notes..."
                    ></textarea>
                </div>
            </div>
            
            <div class="form-actions">
                <button type="submit" class="btn btn-primary btn-large">
                    Save Health Record
                </button>
                <a href="{{ url_for('patients.patient_detail', patient_id=patient._id) }}" class="btn btn-outline">Cancel</a>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Set current datetime as default
document.addEventListener('DOMContentLoaded', function() {
    const timestampInput = document.getElementById('timestamp');
    if (!timestampInput.value) {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        timestampInput.value = `${year}-${month}-${day}T${hours}:${minutes}`;
    }
});
</script>
{% endblock %}
