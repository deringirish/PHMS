{% extends "base.html" %}

{% block title %}Confirm AI Extraction - {{ patient.fullName }} - PHMS{% endblock %}

{% block content %}
<div class="form-page">
    <div class="page-header">
        <div>
            <a href="{{ url_for('patients.patient_detail', patient_id=patient._id) }}" class="breadcrumb">‚Üê {{ patient.fullName }}</a>
            <h1>Confirm AI-Extracted Data</h1>
        </div>
    </div>
    
    <div class="ai-notice">
        <span class="ai-icon">ü§ñ</span>
        <div>
            <h3>AI Extraction Complete</h3>
            <p>Fields highlighted in purple were extracted by AI. Review all fields, edit as needed, and add any missing data before saving.</p>
        </div>
    </div>
    
    <div class="form-container">
        <form method="POST" action="{{ url_for('records.save_ai_record', patient_id=patient._id) }}" class="health-record-form">
            
            <!-- Timestamp -->
            <div class="form-section">
                <h3 class="section-title">Record Information</h3>
                <div class="form-group">
                    <label for="timestamp">Date & Time</label>
                    <input 
                        type="datetime-local" 
                        id="timestamp" 
                        name="timestamp" 
                        class="form-control {{ 'ai-extracted' if data.timestamp else '' }}"
                        value="{{ data.timestamp if data.timestamp else now.strftime('%Y-%m-%dT%H:%M') }}"
                    >
                </div>
            </div>
            
            <!-- Vitals -->
            <div class="form-section">
                <h3 class="section-title">Vitals</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="bpSystolic">Blood Pressure Systolic</label>
                        <input type="number" step="0.01" id="bpSystolic" name="bpSystolic" class="form-control {{ 'ai-extracted' if data.bpSystolic else '' }}" value="{{ data.bpSystolic if data.bpSystolic else '' }}" placeholder="mmHg">
                    </div>
                    
                    <div class="form-group">
                        <label for="bpDiastolic">Blood Pressure Diastolic</label>
                        <input type="number" step="0.01" id="bpDiastolic" name="bpDiastolic" class="form-control {{ 'ai-extracted' if data.bpDiastolic else '' }}" value="{{ data.bpDiastolic if data.bpDiastolic else '' }}" placeholder="mmHg">
                    </div>
                    
                    <div class="form-group">
                        <label for="heartRate">Heart Rate</label>
                        <input type="number" step="0.01" id="heartRate" name="heartRate" class="form-control {{ 'ai-extracted' if data.heartRate else '' }}" value="{{ data.heartRate if data.heartRate else '' }}" placeholder="bpm">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="temperature">Temperature</label>
                        <input type="number" step="0.01" id="temperature" name="temperature" class="form-control {{ 'ai-extracted' if data.temperature else '' }}" value="{{ data.temperature if data.temperature else '' }}" placeholder="¬∞C">
                    </div>
                    
                    <div class="form-group">
                        <label for="spo2">SpO2</label>
                        <input type="number" step="0.01" id="spo2" name="spo2" class="form-control {{ 'ai-extracted' if data.spo2 else '' }}" value="{{ data.spo2 if data.spo2 else '' }}" placeholder="%">
                    </div>
                    
                    <div class="form-group">
                        <label for="weight">Weight</label>
                        <input type="number" step="0.01" id="weight" name="weight" class="form-control {{ 'ai-extracted' if data.weight else '' }}" value="{{ data.weight if data.weight else '' }}" placeholder="kg">
                    </div>
                    
                    <div class="form-group">
                        <label for="height">Height</label>
                        <input type="number" step="0.01" id="height" name="height" class="form-control {{ 'ai-extracted' if data.height else '' }}" value="{{ data.height if data.height else '' }}" placeholder="cm">
                    </div>
                </div>
            </div>
            
            <!-- Diabetes / Glucose -->
            <div class="form-section">
                <h3 class="section-title">Diabetes / Glucose</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="sugarFasting">Fasting Blood Sugar</label>
                        <input type="number" step="0.01" id="sugarFasting" name="sugarFasting" class="form-control {{ 'ai-extracted' if data.sugarFasting else '' }}" value="{{ data.sugarFasting if data.sugarFasting else '' }}" placeholder="mg/dL">
                    </div>
                    
                    <div class="form-group">
                        <label for="sugarPostMeal">Post-Meal Blood Sugar</label>
                        <input type="number" step="0.01" id="sugarPostMeal" name="sugarPostMeal" class="form-control {{ 'ai-extracted' if data.sugarPostMeal else '' }}" value="{{ data.sugarPostMeal if data.sugarPostMeal else '' }}" placeholder="mg/dL">
                    </div>
                    
                    <div class="form-group">
                        <label for="randomBloodSugar">Random Blood Sugar</label>
                        <input type="number" step="0.01" id="randomBloodSugar" name="randomBloodSugar" class="form-control {{ 'ai-extracted' if data.randomBloodSugar else '' }}" value="{{ data.randomBloodSugar if data.randomBloodSugar else '' }}" placeholder="mg/dL">
                    </div>
                    
                    <div class="form-group">
                        <label for="hbA1c">HbA1c</label>
                        <input type="number" step="0.01" id="hbA1c" name="hbA1c" class="form-control {{ 'ai-extracted' if data.hbA1c else '' }}" value="{{ data.hbA1c if data.hbA1c else '' }}" placeholder="%">
                    </div>
                </div>
            </div>
            
            <!-- Lipid Profile -->
            <div class="form-section">
                <h3 class="section-title">Lipid Profile</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="cholesterolTotal">Total Cholesterol</label>
                        <input type="number" step="0.01" id="cholesterolTotal" name="cholesterolTotal" class="form-control {{ 'ai-extracted' if data.cholesterolTotal else '' }}" value="{{ data.cholesterolTotal if data.cholesterolTotal else '' }}" placeholder="mg/dL">
                    </div>
                    
                    <div class="form-group">
                        <label for="cholesterolHDL">HDL Cholesterol</label>
                        <input type="number" step="0.01" id="cholesterolHDL" name="cholesterolHDL" class="form-control {{ 'ai-extracted' if data.cholesterolHDL else '' }}" value="{{ data.cholesterolHDL if data.cholesterolHDL else '' }}" placeholder="mg/dL">
                    </div>
                    
                    <div class="form-group">
                        <label for="cholesterolLDL">LDL Cholesterol</label>
                        <input type="number" step="0.01" id="cholesterolLDL" name="cholesterolLDL" class="form-control {{ 'ai-extracted' if data.cholesterolLDL else '' }}" value="{{ data.cholesterolLDL if data.cholesterolLDL else '' }}" placeholder="mg/dL">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="triglycerides">Triglycerides</label>
                        <input type="number" step="0.01" id="triglycerides" name="triglycerides" class="form-control {{ 'ai-extracted' if data.triglycerides else '' }}" value="{{ data.triglycerides if data.triglycerides else '' }}" placeholder="mg/dL">
                    </div>
                    
                    <div class="form-group">
                        <label for="vldl">VLDL</label>
                        <input type="number" step="0.01" id="vldl" name="vldl" class="form-control {{ 'ai-extracted' if data.vldl else '' }}" value="{{ data.vldl if data.vldl else '' }}" placeholder="mg/dL">
                    </div>
                </div>
            </div>
            
            <!-- Kidney Function -->
            <div class="form-section">
                <h3 class="section-title">Kidney Function</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="serumCreatinine">Serum Creatinine</label>
                        <input type="number" step="0.01" id="serumCreatinine" name="serumCreatinine" class="form-control {{ 'ai-extracted

' if data.serumCreatinine else '' }}" value="{{ data.serumCreatinine if data.serumCreatinine else '' }}" placeholder="mg/dL">
                    </div>
                    
                    <div class="form-group">
                        <label for="bloodUrea">Blood Urea</label>
                        <input type="number" step="0.01" id="bloodUrea" name="bloodUrea" class="form-control {{ 'ai-extracted' if data.bloodUrea else '' }}" value="{{ data.bloodUrea if data.bloodUrea else '' }}" placeholder="mg/dL">
                    </div>
                    
                    <div class="form-group">
                        <label for="bun">BUN</label>
                        <input type="number" step="0.01" id="bun" name="bun" class="form-control {{ 'ai-extracted' if data.bun else '' }}" value="{{ data.bun if data.bun else '' }}" placeholder="mg/dL">
                    </div>
                    
                    <div class="form-group">
                        <label for="eGFR">eGFR</label>
                        <input type="number" step="0.01" id="eGFR" name="eGFR" class="form-control {{ 'ai-extracted' if data.eGFR else '' }}" value="{{ data.eGFR if data.eGFR else '' }}" placeholder="mL/min/1.73m¬≤">
                    </div>
                </div>
            </div>
            
            <!-- Liver Function -->
            <div class="form-section">
                <h3 class="section-title">Liver Function</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="sgptAlt">SGPT/ALT</label>
                        <input type="number" step="0.01" id="sgptAlt" name="sgptAlt" class="form-control {{ 'ai-extracted' if data.sgptAlt else '' }}" value="{{ data.sgptAlt if data.sgptAlt else '' }}" placeholder="U/L">
                    </div>
                    
                    <div class="form-group">
                        <label for="sgotAst">SGOT/AST</label>
                        <input type="number" step="0.01" id="sgotAst" name="sgotAst" class="form-control {{ 'ai-extracted' if data.sgotAst else '' }}" value="{{ data.sgotAst if data.sgotAst else '' }}" placeholder="U/L">
                    </div>
                    
                    <div class="form-group">
                        <label for="alkalinePhosphatase">Alkaline Phosphatase</label>
                        <input type="number" step="0.01" id="alkalinePhosphatase" name="alkalinePhosphatase" class="form-control {{ 'ai-extracted' if data.alkalinePhosphatase else '' }}" value="{{ data.alkalinePhosphatase if data.alkalinePhosphatase else '' }}" placeholder="U/L">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="totalBilirubin">Total Bilirubin</label>
                        <input type="number" step="0.01" id="totalBilirubin" name="totalBilirubin" class="form-control {{ 'ai-extracted' if data.totalBilirubin else '' }}" value="{{ data.totalBilirubin if data.totalBilirubin else '' }}" placeholder="mg/dL">
                    </div>
                    
                    <div class="form-group">
                        <label for="directBilirubin">Direct Bilirubin</label>
                        <input type="number" step="0.01" id="directBilirubin" name="directBilirubin" class="form-control {{ 'ai-extracted' if data.directBilirubin else '' }}" value="{{ data.directBilirubin if data.directBilirubin else '' }}" placeholder="mg/dL">
                    </div>
                    
                    <div class="form-group">
                        <label for="indirectBilirubin">Indirect Bilirubin</label>
                        <input type="number" step="0.01" id="indirectBilirubin" name="indirectBilirubin" class="form-control {{ 'ai-extracted' if data.indirectBilirubin else '' }}" value="{{ data.indirectBilirubin if data.indirectBilirubin else '' }}" placeholder="mg/dL">
                    </div>
                </div>
            </div>
            
            <!-- Electrolytes -->
            <div class="form-section">
                <h3 class="section-title">Electrolytes</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="sodium">Sodium</label>
                        <input type="number" step="0.01" id="sodium" name="sodium" class="form-control {{ 'ai-extracted' if data.sodium else '' }}" value="{{ data.sodium if data.sodium else '' }}" placeholder="mEq/L">
                    </div>
                    
                    <div class="form-group">
                        <label for="potassium">Potassium</label>
                        <input type="number" step="0.01" id="potassium" name="potassium" class="form-control {{ 'ai-extracted' if data.potassium else '' }}" value="{{ data.potassium if data.potassium else '' }}" placeholder="mEq/L">
                    </div>
                    
                    <div class="form-group">
                        <label for="chloride">Chloride</label>
                        <input type="number" step="0.01" id="chloride" name="chloride" class="form-control {{ 'ai-extracted' if data.chloride else '' }}" value="{{ data.chloride if data.chloride else '' }}" placeholder="mEq/L">
                    </div>
                </div>
            </div>
            
            <!-- Hematology (CBC) -->
            <div class="form-section">
                <h3 class="section-title">Hematology (CBC)</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="hemoglobin">Hemoglobin</label>
                        <input type="number" step="0.01" id="hemoglobin" name="hemoglobin" class="form-control {{ 'ai-extracted' if data.hemoglobin else '' }}" value="{{ data.hemoglobin if data.hemoglobin else '' }}" placeholder="g/dL">
                    </div>
                    
                    <div class="form-group">
                        <label for="totalLeukocyteCount">WBC Count</label>
                        <input type="number" step="0.01" id="totalLeukocyteCount" name="totalLeukocyteCount" class="form-control {{ 'ai-extracted' if data.totalLeukocyteCount else '' }}" value="{{ data.totalLeukocyteCount if data.totalLeukocyteCount else '' }}" placeholder="cells/ŒºL">
                    </div>
                    
                    <div class="form-group">
                        <label for="plateletCount">Platelet Count</label>
                        <input type="number" step="0.01" id="plateletCount" name="plateletCount" class="form-control {{ 'ai-extracted' if data.plateletCount else '' }}" value="{{ data.plateletCount if data.plateletCount else '' }}" placeholder="lakhs">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="rbcCount">RBC Count</label>
                        <input type="number" step="0.01" id="rbcCount" name="rbcCount" class="form-control {{ 'ai-extracted' if data.rbcCount else '' }}" value="{{ data.rbcCount if data.rbcCount else '' }}" placeholder="million/ŒºL">
                    </div>
                    
                    <div class="form-group">
                        <label for="pcv">PCV</label>
                        <input type="number" step="0.01" id="pcv" name="pcv" class="form-control {{ 'ai-extracted' if data.pcv else '' }}" value="{{ data.pcv if data.pcv else '' }}" placeholder="%">
                    </div>
                    
                    <div class="form-group">
                        <label for="mcv">MCV</label>
                        <input type="number" step="0.01" id="mcv" name="mcv" class="form-control {{ 'ai-extracted' if data.mcv else '' }}" value="{{ data.mcv if data.mcv else '' }}" placeholder="fL">
                    </div>
                </div>
            </div>
            
            <!-- Thyroid -->
            <div class="form-section">
                <h3 class="section-title">Thyroid Function</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="tsh">TSH</label>
                        <input type="number" step="0.01" id="tsh" name="tsh" class="form-control {{ 'ai-extracted' if data.tsh else '' }}" value="{{ data.tsh if data.tsh else '' }}" placeholder="ŒºIU/mL">
                    </div>
                    
                    <div class="form-group">
                        <label for="t3">T3</label>
                        <input type="number" step="0.01" id="t3" name="t3" class="form-control {{ 'ai-extracted' if data.t3 else '' }}" value="{{ data.t3 if data.t3 else '' }}" placeholder="ng/dL">
                    </div>
                    
                    <div class="form-group">
                        <label for="t4">T4</label>
                        <input type="number" step="0.01" id="t4" name="t4" class="form-control {{ 'ai-extracted' if data.t4 else '' }}" value="{{ data.t4 if data.t4 else '' }}" placeholder="Œºg/dL">
                    </div>
                </div>
            </div>
            
            <!-- Vitamins -->
            <div class="form-section">
                <h3 class="section-title">Vitamins</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="vitaminD">Vitamin D</label>
                        <input type="number" step="0.01" id="vitaminD" name="vitaminD" class="form-control {{ 'ai-extracted' if data.vitaminD else '' }}" value="{{ data.vitaminD if data.vitaminD else '' }}" placeholder="ng/mL">
                    </div>
                    
                    <div class="form-group">
                        <label for="vitaminB12">Vitamin B12</label>
                        <input type="number" step="0.01" id="vitaminB12" name="vitaminB12" class="form-control {{ 'ai-extracted' if data.vitaminB12 else '' }}" value="{{ data.vitaminB12 if data.vitaminB12 else '' }}" placeholder="pg/mL">
                    </div>
                </div>
            </div>
            
            <!-- Notes -->
            <div class="form-section">
                <h3 class="section-title">Additional Notes</h3>
                
                <div class="form-group">
                    <label for="notes">Notes</label>
                    <textarea 
                        id="notes" 
                        name="notes" 
                        class="form-control"
                        rows="4"
                        placeholder="Add any additional observations or corrections..."
                    >{{ data.notes if data.notes else '' }}</textarea>
                </div>
            </div>
            
            <div class="form-actions">
                <button type="submit" class="btn btn-primary btn-large">
                    ‚úì Confirm & Save Record
                </button>
                <a href="{{ url_for('patients.patient_detail', patient_id=patient._id) }}" class="btn btn-outline">Cancel</a>
            </div>
        </form>
    </div>
</div>
{% endblock %}
